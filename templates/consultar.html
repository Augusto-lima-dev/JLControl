{% extends "base.html" %}

{% load static %}
{% load controle_comandos %}

{% block content %}
{% if cliente == '#ERRO001' %}

<div class="alert alert-danger" role="alert">
  Telefone duplicado ou não encontrado
</div>
{% endif %}
{% if cliente == '#ERRO2' %}
<div class="alert alert-danger" role="alert">
  Por favor digite o CPF.
</div>
{% endif %}
{% if locacoes is not None %}
{% for key, locacao in locacoes.items %}
<div class="container">
  <div class="row">
    <table>
      <td scope="col">
        <button class="btn btn-dark btn-lg btn-block" type="button" data-toggle="collapse"
          data-target="#ID{{ locacao.id }}" aria-expanded="false" aria-controls="collapseExample">
          {{cliente.nome }} / ID: {{ locacao.id }} - {{ locacao.status }} - {{ locacao.data_locacao}}
        </button>
      </td>
      <td scope="col"> <button class="btn btn-info btn-lg btn-block" type="button"
          onclick="location.href='{% url 'devolver_locacao' %}'+'?id_locacao={{ locacao.id }}';">Devolver</button>
      </td>
    </table>
    </p>
    <div class="collapse" id="ID{{ locacao.id }}">
      <div class="card card-body">
        {% for key, item in locacao.item.items %}
        <table>
        <td>{{ item.id }} - {{ item.status }} - {{ item.traje.nome }} - {{ item.data_entrega }}
          
          <br>
          
        </td>
        <td>
        <div style="text-align: right;">
        <button type="button" class="btn btn-dark" style="margin-left: 5%; align-items: center;"
        data-toggle="modal" data-target="#ModalMedidasConsultar" 
        onclick="abriModalConsultar('{{ item.medida.paleto_barra}}', '{{ item.medida.calca_barra }}', '{{ item.medida.costas }}', '{{ item.medida.torax }}')"
        >Abrir ficha de medidas</button></td>
        </div>
        </table>
        {% endfor %}
      </div>

    </div>
  </div>
</div>
{% endfor %}
{% endif %}

{% if trajes_disponiveis %}
{% if not locacoes %}
<table class="table">
  <thead class="thead-dark">
    <tr>
      <th scope="col">#</th>
      <th scope="col">Codigo</th>
      <th scope="col">Nome</th>
      <th scope="col">Modelo</th>
      <th scope="col">Corte</th>
      <th scope="col">Valor</th>
      <th scope="col">Disponibilidade</th>
    </tr>
  </thead>
  <tbody>
    {% for traje in trajes_disponiveis %}
    <tr>
      <th scope="row">{{ forloop.counter }}</th>
      <td>{{ traje.codigo }}</td>
      <td>{{ traje.nome }}</td>
      <td>{{ traje.modelo }}</td>
      <td>{{ traje.corte }}</td>
      <td>{{ traje.valor }}</td>
      {% if MostraAlocados %}
      <td>Alocado</td>
      {% else %}
      <td>Disponível</td><!-- <button class="btn btn-primary" type="button">Alocar</button>-->
      {% endif %}
    </tr>
    {% endfor %}
    <tr class="thead-light">
      <th>Total:</th>
      <th>{{ trajes_disponiveis|length }} </th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </tbody>
</table>
{% endif %}
{% endif %}

<script>
  function devolver_locacao(id) {
    const url = '{% url 'devolver_locacao' %}?id_locacao=' + id

    fetch(url).then(response => {
      return response.json();
    }).then(resposta => {
      if (resposta == "deu certo") {
        alert("deu boa")
      }
    });

  }
</script>

<script>
  function abriModalConsultar(paleto_barra, calca_barra, costas, torax){
        document.getElementById("formMedidaPaletoConsultar").value = parseFloat(paleto_barra)
        document.getElementById("formMedidaCalcaConsultar").value = parseFloat(calca_barra)
        document.getElementById("formMedidaToraxConsultar").value = parseFloat(costas)
        document.getElementById("formMedidaCostasConsultar").value = parseFloat(torax)
  }
</script>

<!-- Modal Medidas -->
<div class="modal fade" id="ModalMedidasConsultar" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="exampleModalLabel">Consulte a ficha de medidas:</h5>
                <button id="fechaModal" type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <form name="formMedidas" action="" method="post">
                    {% csrf_token %}
                    <div class="form-group row">
                        <label for="formMedidaPaletoConsultar" class="col-sm-2 col-form-label">Barra paleto </label>
                        <div class="col-sm-10">
                            <input id="formMedidaPaletoConsultar" class="form-control" type="number" name="paleto_barra" min="0"
                                step=".01" placeholder="Barra paleto">
                        </div>
                    </div>

                    <div class="form-group row">
                        <label for="formMedidaCalcaConsultar" class="col-sm-2 col-form-label">Barra Calça </label>
                        <div class="col-sm-10">
                            <input id="formMedidaCalcaConsultar" class="form-control" type="number" name="calca_barra" min="0"
                                step=".01" placeholder="Barra Calca">
                        </div>
                    </div>

                    <div class="form-group row">
                        <label for="formMedidaToraxConsultar
                        " class="col-sm-2 col-form-label">Torax</label>
                        <div class="col-sm-10">
                            <input id="formMedidaToraxConsultar" class="form-control" type="number" name="torax" min="0"
                                step=".01" placeholder="Torax">
                        </div>
                    </div>

                    <div class="form-group row">
                        <label for="formMedidaCostasConsultar" class="col-sm-2 col-form-label">Costas </label>
                        <div class="col-sm-10">
                            <input id="formMedidaCostasConsultar" class="form-control" type="number" name="costas" min="0"
                                step=".01" placeholder="Costas">
                        </div>
                    </div>

                    <button type="button" class="btn btn-primary btn-lg btn-block" data-dismiss="modal">Fechar</button>
                </form>
            </div>
        </div>
    </div>
</div>

{% endblock %}